<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ACE FLOW - Agentes de Combate às Endemias</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ACE FLOW">
    <link rel="apple-touch-icon" href="https://i.imgur.com/snkCnil.png">
    <meta name="theme-color" content="#F5F0E6">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- PWA MANIFEST ---
            const manifest = {
                "id": "/",
                "name": "ACE FLOW",
                "short_name": "ACE FLOW",
                "scope": ".",
                "start_url": ".",
                "display": "standalone",
                "background_color": "#F5F0E6",
                "theme_color": "#4338CA",
                "description": "App para registro de trabalho de Agentes de Combate às Endemias.",
                // ================== LOGO ATUALIZADA AQUI ==================
                "icons": [
                    { "src": "https://i.imgur.com/snkCnil.png", "sizes": "512x512", "type": "image/png", "purpose": "any maskable" }
                ]
                // ==========================================================
            };
            const manifestString = JSON.stringify(manifest);
            const blob = new Blob([manifestString], {type: 'application/json'});
            const manifestURL = URL.createObjectURL(blob);
            const linkTag = document.createElement('link');
            linkTag.rel = 'manifest';
            linkTag.href = manifestURL;
            document.head.appendChild(linkTag);

            // --- SERVICE WORKER ---
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'ace-flow-cache-v51'; // Cache version bumped
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME).then(cache => {
                                return cache.add('.'); 
                            }).catch(error => {
                                console.error('[Service Worker] Falha no pré-cache:', error);
                            })
                        );
                        self.skipWaiting();
                    });

                    self.addEventListener('activate', event => {
                        event.waitUntil(
                            caches.keys().then(cacheNames => {
                                return Promise.all(
                                    cacheNames.map(cacheName => {
                                        if (cacheName !== CACHE_NAME) {
                                            console.log('[Service Worker] Limpando cache antigo:', cacheName);
                                            return caches.delete(cacheName);
                                        }
                                    })
                                );
                            }).then(() => self.clients.claim())
                        );
                    });

                    self.addEventListener('fetch', event => {
                        if (event.request.method !== 'GET' || event.request.url.startsWith('chrome-extension://')) {
                            return;
                        }

                        const isApiRequest = event.request.url.startsWith('https://script.google.com') || event.request.url.startsWith('https://generativelanguage.googleapis.com');
                        if (isApiRequest) {
                            event.respondWith(fetch(event.request));
                            return;
                        }

                        event.respondWith(
                            caches.match(event.request).then(cachedResponse => {
                                const fetchPromise = fetch(event.request).then(networkResponse => {
                                    if (networkResponse && networkResponse.status === 200) {
                                        return caches.open(CACHE_NAME).then(cache => {
                                            cache.put(event.request, networkResponse.clone());
                                            return networkResponse;
                                        });
                                    }
                                    return networkResponse;
                                });
                                return cachedResponse || fetchPromise;
                            })
                        );
                    });
                `;
                const swBlob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(swBlob);
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register(swUrl)
                        .then(reg => console.log('ServiceWorker registrado com sucesso.', reg.scope))
                        .catch(err => console.log('Falha ao registrar ServiceWorker:', err));
                });
            }
        });
    </script>
    
    <style>
        :root {
            --bg-main: #F5F0E6; --bg-card: #FFFFFF; --text-dark: #000000;
            --text-muted: #575757; --border-color: #DED6C7; --alert-red: #DC2626;
            --confirm-green: #16A34A; --khaki-base: #C3B091; --khaki-dark: #a9997c;
        }
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: var(--text-dark); }
        .card { background-color: var(--bg-card); border-radius: 0.75rem; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border: 1px solid var(--border-color); }
        .section-title { font-weight: 700; font-size: 1.25rem; color: var(--text-dark); }
        .form-input, .form-select {
            width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 2px solid var(--border-color);
            background-color: var(--bg-card); transition: all 0.2s ease;
        }
        .form-input:focus, .form-select:focus {
            outline: none; border-color: var(--khaki-base); box-shadow: 0 0 0 3px rgba(195, 176, 145, 0.4);
        }
        .form-input.is-filled, .form-select.is-filled { border-color: var(--confirm-green); }
        .btn {
            padding: 0.8rem 1.25rem; border-radius: 0.5rem; font-weight: 700; transition: all 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 0.5rem; cursor: pointer; border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .btn:disabled { background-color: #9ca3af; cursor: not-allowed; opacity: 0.7; }
        .hidden-content { display: none; overflow: hidden; transition: max-height 0.5s ease-in-out; max-height: 0; }
        .hidden-content.show { display: block; max-height: 1500px; }
        .toggle-check {
            width: 100%; height: 46px; font-weight: 700; font-size: 1.1rem; cursor: pointer;
            border: 2px solid var(--border-color); border-radius: 0.5rem; background-color: var(--bg-card);
            transition: all 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .toggle-check.tratado.is-checked { background-color: #dcfce7; color: var(--confirm-green); border-color: var(--confirm-green); }
        .toggle-check.foco.is-checked { background-color: #fee2e2; color: var(--alert-red); border-color: var(--alert-red); }
        #fixed-info-bar {
            position: sticky; top: 0; z-index: 40; transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .modal { 
            background-color: rgba(0, 0, 0, 0.7); 
            display: flex; 
            align-items: flex-start; 
            justify-content: center;
            padding-top: 5vh;
            padding-bottom: 5vh;
            overflow-y: auto;
        }
        option.important-value { font-weight: 700; background-color: #eeeeee; }
        
        /* Landing Page Remodel */
        #landingPage { 
            background: radial-gradient(circle, rgba(245,240,230,1) 0%, rgba(222,214,199,1) 100%);
            animation: fadeIn 1.5s ease-in-out; 
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .glow-text {
            background: linear-gradient(90deg, var(--khaki-dark), var(--text-dark), var(--khaki-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: glow 10s linear infinite;
            background-size: 200% auto;
        }
        @keyframes glow { to { background-position: 200% center; } }
        .feature-card {
            background-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 30px rgba(0,0,0,0.15);
        }
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--khaki-base);
            border-radius: 50%;
            width: 50px; height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* FAQ/Curiosities Styles */
        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            padding: 0 1.5rem;
        }
        .faq-answer.show {
            max-height: 1000px; /* Adjust as needed */
            padding: 1rem 1.5rem 1.5rem;
        }
        .faq-question.active .faq-toggle-icon {
            transform: rotate(45deg);
        }

        /* Shine/Pulse Animation for CTA */
        .btn-shine {
            position: relative;
            overflow: hidden;
        }
        .btn-shine::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(45deg);
            animation: pulse-shine 4s infinite linear;
        }
        @keyframes pulse-shine {
            0% { transform: scale(0.5) rotate(45deg); opacity: 0; }
            50% { transform: scale(1) rotate(45deg); opacity: 1; }
            100% { transform: scale(1.5) rotate(45deg); opacity: 0; }
        }

    </style>
</head>

<body class="antialiased">

    <div id="landingPage">
        <div class="container mx-auto px-4 py-16 md:py-24 text-center">
            <header class="mb-20">
                <h1 class="text-6xl md:text-8xl font-black tracking-tighter mb-4 glow-text">ACE FLOW</h1>
                <p class="max-w-3xl mx-auto text-xl md:text-2xl font-semibold text-text-muted">
                    Sua rotina de campo, reinventada. Foco no que importa, com a tecnologia como sua aliada.
                </p>
            </header>

            <div class="space-y-24">
                <section class="fade-in-section">
                    <h2 class="text-4xl font-extrabold mb-12">Inteligência de Dados para Ações Precisas</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="feature-card p-8">
                            <div class="text-5xl mb-4">📊</div>
                            <h3 class="text-xl font-bold mb-2">Relatórios Completos</h3>
                            <p class="text-text-muted">Transforme seus dados em insights visuais. Gere relatórios dinâmicos com gráficos intuitivos e analise sua produtividade através de filtros de tempo flexíveis, do trabalho diário ao desempenho anual.</p>
                        </div>
                        <div class="feature-card p-8">
                            <div class="text-5xl mb-4">✨</div>
                            <h3 class="text-xl font-bold mb-2">Análise com IA</h3>
                            <p class="text-text-muted">Receba resumos e planos de ação gerados por Inteligência Artificial para otimizar suas visitas e focar em áreas de risco.</p>
                        </div>
                        <div class="feature-card p-8">
                            <div class="text-5xl mb-4">📋</div>
                            <h3 class="text-xl font-bold mb-2">PDFs Profissionais</h3>
                            <p class="text-text-muted">Exporte seus dados em PDFs autoexplicativos e resumidos. Um formato profissional, pronto para arquivamento ou compartilhamento, que reflete a qualidade do seu trabalho.</p>
                        </div>
                    </div>
                </section>

                <section class="fade-in-section">
                     <h2 class="text-4xl font-extrabold mb-12">Ferramentas que Agilizam seu Dia a Dia</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="feature-card p-8">
                            <div class="text-5xl mb-4">✍️</div>
                            <h3 class="text-xl font-bold mb-2">Preenchimento Inteligente</h3>
                            <p class="text-text-muted">Deixe o app trabalhar por você. Nossa tecnologia de preenchimento inteligente antecipa seus próximos passos, replicando informações de forma automática e garantindo registros rápidos e consistentes.</p>
                        </div>
                         <div class="feature-card p-8">
                            <div class="text-5xl mb-4">💧</div>
                            <h3 class="text-xl font-bold mb-2">Cálculos Rápidos</h3>
                            <p class="text-text-muted">Calcule o volume de reservatórios e a sua meta diária de forma automática, ganhando tempo e precisão em campo.</p>
                        </div>
                        <div class="feature-card p-8">
                           <div class="text-5xl mb-4">📱</div>
                            <h3 class="text-xl font-bold mb-2">Experiência de App Real</h3>
                            <p class="text-text-muted">Instale no seu celular para uma experiência em tela cheia, sem a barra do navegador, com funcionamento 100% offline e sem perda de dados.</p>
                        </div>
                    </div>
                </section>

                <section class="fade-in-section">
                     <h2 class="text-4xl font-extrabold mb-12">Educação e Conhecimento na Palma da Mão</h2>
                    <div class="grid grid-cols-1">
                         <div class="feature-card p-8 max-w-2xl mx-auto">
                            <div class="text-5xl mb-4">💡</div>
                            <h3 class="text-xl font-bold mb-2">Guia de Curiosidades</h3>
                            <p class="text-text-muted">Domine o conhecimento. Acesse um guia completo que vai de dúvidas básicas a curiosidades avançadas sobre a Dengue e o Aedes. Uma ferramenta poderosa para sua capacitação e para orientar a população.</p>
                        </div>
                    </div>
                </section>
            </div>

            <footer class="mt-24 py-12 fade-in-section">
                <h2 class="text-4xl font-extrabold mb-4">Pronto para Elevar seu Nível?</h2>
                <div class="flex flex-col md:flex-row justify-center items-center gap-4 mt-8">
                    <button id="startWebButton" class="btn btn-shine bg-indigo-700 text-white hover:bg-indigo-800 w-full md:w-auto text-xl py-4 px-8 shadow-lg transform hover:scale-105">Vamos lá? Clique aqui agora</button>
                    <button id="installAppButton" class="btn bg-black text-white hover:bg-gray-800 w-full md:w-auto text-lg hidden">
                         <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        Instalar no Aparelho (Offline)
                    </button>
                </div>
                 <p id="install-instructions" class="text-sm text-text-muted mt-4 max-w-2xl mx-auto hidden">
                    Ao clicar em "Instalar", o app será adicionado à sua tela inicial, como um aplicativo normal, para acesso rápido e funcionamento offline.
                </p>
            </footer>
        </div>
    </div>
    
    <div id="fixed-info-bar" class="bg-white/80 backdrop-blur-sm p-2 text-center text-sm font-semibold hidden">
        <span id="fixed-agent-name"></span> - <span id="fixed-property-info"></span>
    </div>
    
    <div id="loginModal" class="fixed inset-0 z-50 modal hidden">
        <div class="bg-white rounded-lg shadow-xl p-8 w-11/12 max-w-sm card">
            <h2 class="text-2xl font-bold text-center mb-1">Bem-vindo ao</h2>
            <h1 class="text-4xl font-extrabold text-center mb-6">ACE FLOW</h1>
            <form id="loginForm">
                <div class="mb-4">
                    <label for="username" class="block text-sm font-medium text-text-muted mb-1">Usuário</label>
                    <input type="text" id="username" class="form-input" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-text-muted mb-1">Senha</label>
                    <input type="password" id="password" class="form-input" required>
                </div>
                <button type="submit" id="loginBtn" class="btn bg-blue-800 text-white hover:bg-blue-900 w-full text-lg transform hover:scale-105">Entrar</button>
                <p id="loginError" class="text-red-600 text-center mt-4 h-4"></p>
            </form>
        </div>
    </div>

    <main class="container mx-auto p-3 md:p-6 max-w-4xl hidden">
        <header class="text-center mb-8 py-4">
            <h1 class="text-5xl font-extrabold"><strong>ACE FLOW</strong></h1>
            <p class="text-lg font-bold">Agentes de Combate às Endemias</p>
            <p class="text-md"><em>Registre aqui
